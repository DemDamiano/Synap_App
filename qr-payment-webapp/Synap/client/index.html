<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Synap App</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="js/app.js" defer></script>
</head>
<body>

    <header class="topbar">
        <div class="brand">
            <span class="logo-icon">‚ùñ</span> Synap
        </div>
        <div class="user-profile">
            <span class="user-name">...</span>
            <button onclick="handleLogout()" class="btn-logout">Exit</button>
        </div>
    </header>

    <main>
        <section id="view-login" class="view active">
            <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                <div class="card">
                    <h1>Welcome</h1>
                    <p class="status-text">Your journey, measured by the Tangle.</p>
                    <form id="login-form">
                        <input type="email" id="email" placeholder="Email" required>
                        <input type="password" id="password" placeholder="Password" required>
                        <button type="submit" class="btn primary">Login</button>
                    </form>
                </div>
                <div style="text-align: center;">
                    <button onclick="showView('register')" class="link">Don't have an account? Sign up</button>
                </div>
            </div>
            <div class="iota-footer">
                Powered by IOTA
            </div>
        </section>

        <section id="view-register" class="view">
            <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                <div class="card">
                    <h1>Create Account</h1>
                    <p class="status-text">Join Synap</p>
                    <form id="register-form">
                        <input type="text" id="reg-name" placeholder="Your Name" required>
                        <input type="email" id="reg-email" placeholder="Email" required>
                        <input type="password" id="reg-password" placeholder="Password" required>
                        <button type="submit" class="btn primary">Sign Up</button>
                    </form>
                    <button onclick="showView('login')" class="link" style="margin-top: 15px;">Back to Login</button>
                </div>
            </div>
            <div class="iota-footer">
                Powered by IOTA
            </div>
        </section>

       <section id="view-home" class="view">
    <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
        
        <div class="card" style="padding: 40px 20px;">
            <p class="status-text" style="margin-bottom: 10px;">Saldo Disponibile</p>
            <div class="balance">
                <span id="balance-amount">...</span> 
            </div>
            <span class="currency">IOTA</span>
            
            <div id="debt-warning" style="display: none; margin-top: 25px; animation: fadeIn 0.5s;">
                <div style="background: #ffecec; border: 1px solid #fab1a0; border-radius: 15px; padding: 15px;">
                    <div style="color: #d63031; font-weight: 700; font-size: 1.1rem; margin-bottom: 5px;">
                        ‚ö†Ô∏è DEBITO: <span id="debt-amount">0.00</span>
                    </div>
                    <p style="font-size: 0.85rem; color: #636e72; margin: 0 0 10px 0;">
                        Devi saldare il debito prima di poter viaggiare di nuovo.
                    </p>
                    <button onclick="handlePayDebt()" class="btn danger" id="btn-pay-debt">
                        SALDA DEBITO ORA
                    </button>
                </div>
            </div>
        </div>
        
        <button id="btn-scan-start" onclick="startScanner('START')" class="btn primary">
            SCAN QR (CHECK-IN)
        </button>
        
        <p style="text-align: center; color: #b2bec3; font-size: 0.8rem; margin-top: 10px;">
            Oppure scansiona per uscire
        </p>
        <button onclick="startScanner('END')" class="btn secondary" style="padding: 10px;">
            CHECK-OUT RAPIDO
        </button>
    </div>
    <div class="iota-footer">Powered by IOTA</div>
</section>

        <section id="view-scan" class="view">
            <div style="flex-grow: 1; display: flex; flex-direction: column;">
                
                <h2 style="text-align: center; margin-top: 20px; color: #2d3436;">Scan the QR Code</h2>

                <div style="padding: 10px;">
                    <div id="reader"></div> 
                </div>

                <div style="padding: 0 10px; margin-top: 10px;">
                    <input type="text" id="manual-code-input" placeholder="Manual Code (e.g. IN-BUS-01)">
                    <button onclick="handleManualEntry()" class="btn primary">CONFIRM</button>
                </div>

                <div id="passenger-selection-box" class="card" style="margin: 20px 10px; padding: 20px;">
                    <p style="margin: 0 0 15px 0; color: #636e72; font-weight: 600;">Passengers</p>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                        <button onclick="changePassenger(-1)" class="btn secondary slim-btn-circle">-</button>
                        <span id="passenger-count-display" class="gradient-text" style="font-size: 2.2rem; font-weight: 700;">1</span>
                        <button onclick="changePassenger(1)" class="btn secondary slim-btn-circle">+</button>
                    </div>
                </div>

                <div style="text-align: center;">
                     <button onclick="showView('home')" class="link">Cancel</button>
                </div>
            </div>
            <div class="iota-footer">
                Powered by IOTA
            </div>
        </section>

        <section id="view-trip" class="view">
            <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                <div class="card" style="border: 2px solid #f1f2f6; padding: 40px 20px;">
                    
                    <div class="bus-animation">üöå</div>
                    <h2 style="color: #2d3436; font-weight: 700; margin-bottom: 5px; margin-top: 10px;">ON TRIP</h2>
                    
                    <div style="margin-bottom: 30px;">
                        <p style="margin: 0; font-size: 1rem; color: #636e72; font-weight: 600;">
                            BUS <span id="trip-id-display" style="color: #a18cd1;">--</span>
                        </p>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #b2bec3;">
                            Passengers: <strong id="trip-passengers-display" style="color: #2d3436;">1</strong>
                        </p>
                    </div>
                    
                    <div class="live-stats" style="margin: 20px 0;">
                        <p style="font-size: 4rem; margin: 0; font-weight: 700; line-height: 1;" class="gradient-text">
                            <span id="trip-cost">0.00</span> 
                        </p>
                        <span style="font-size: 1rem; color: #b2bec3;">Total IOTA</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #b2bec3; margin-top: 20px; padding-top: 20px; border-top: 1px solid #f1f2f6;">
                        <div style="text-align: left;">
                            <span>Route</span><br>
                            <strong id="trip-route-display" style="color: #a18cd1;">--</strong>
                        </div>
                        <div style="text-align: right;">
                            <span>Rate</span><br>
                            <strong id="trip-rate-display" style="color: #636e72;">--</strong> /s
                        </div>
                    </div>
                    
                    <div id="trip-timer" class="timer" style="display: none;">00:00</div>
                </div>

                <button onclick="startScanner('END')" class="btn danger" style="padding: 20px; font-size: 1.1rem; box-shadow: 0 10px 30px rgba(255, 154, 158, 0.4);">CHECK-OUT</button>
            </div>
            <div class="iota-footer">
                Powered by IOTA
            </div>
        </section>

        <section id="view-result" class="view">
            <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                <div class="ticket card"></div>
            </div>
            <div class="iota-footer">
                Powered by IOTA
            </div>
        </section>
    </main>

    <div id="custom-modal" class="modal-overlay">
        <div class="modal-content">
            <div id="modal-icon" class="modal-icon"></div>
            <div id="modal-title" class="modal-title"></div>
            <div id="modal-msg" class="modal-msg"></div>
            <button onclick="closeModal()" class="btn primary">OK</button>
        </div>
    </div>

</body>
</html>