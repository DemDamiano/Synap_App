<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Synap App</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="app.js" defer></script>
</head>
<body>

    <header class="topbar">
        <div class="brand">Synap</div>
        <div class="user-profile">
            <span class="user-name">...</span>
            <button onclick="handleLogout()" class="btn-logout">Esci</button>
        </div>
    </header>

    <main>
        <section id="view-login" class="view active">
            <div class="card">
                <h1>Benvenuto</h1>
                <p class="status-text">Entra nel futuro dei trasporti</p>
                <form id="login-form">
                    <input type="email" id="email" placeholder="Email" required>
                    <input type="password" id="password" placeholder="Password" required>
                    <button type="submit" class="btn primary">Accedi</button>
                </form>
                
                <div style="margin-top: 20px;">
                    <p>Non hai un account?</p>
                    <button onclick="showView('register')" class="link">Crea un account</button>
                </div>
            </div>
        </section>

        <section id="view-register" class="view">
            <div class="card">
                <h1>Crea Account</h1>
                <p class="status-text">Unisciti a Synap</p>
                <form id="register-form">
                    <input type="text" id="reg-name" placeholder="Il tuo Nome" required>
                    <input type="email" id="reg-email" placeholder="Email" required>
                    <input type="password" id="reg-password" placeholder="Password" required>
                    
                    <button type="submit" class="btn primary">Registrati</button>
                </form>
                
                <button onclick="showView('login')" class="link" style="margin-top: 15px;">
                    Torna al Login
                </button>
            </div>
        </section>

        <section id="view-home" class="view">
            <div class="card">
                <p class="status-text">Il tuo saldo disponibile</p>
                <div class="balance">
                    <span id="balance-amount">10.00</span> 
                    <span class="currency">IOTA</span>
                </div>
            </div>
            
            <button onclick="startScanner('START')" class="btn primary">ðŸ“· Inizia Viaggio (IN)</button>
        </section>

        <section id="view-scan" class="view">
            <h2 style="margin-bottom: 20px;">Scansiona QR</h2>
            
            <div id="reader"></div> 
            
            <div class="card">
                <p class="status-text">Oppure inserisci codice</p>
                <input type="text" id="manual-code-input" placeholder="Es. IN-BUS-01">
                <button onclick="handleManualEntry()" class="btn secondary">Conferma Manuale</button>
                <button onclick="showView('home')" class="btn link" style="margin-top:10px">Annulla</button>
            </div>
        </section>

        <section id="view-trip" class="view">
            <div class="card pulsate">
                <div style="font-size: 50px;">ðŸšŒ</div>
                <h2>In Viaggio</h2>
                <p class="status-text">Veicolo: <strong id="trip-id-display">--</strong></p>
                
                <div class="live-stats" style="margin: 20px 0;">
                    <div id="trip-timer" class="timer">00:00</div>
                    <p style="font-size: 1.2rem; color: #8E8E93;">
                        Stima: <strong id="trip-cost" style="color: var(--primary);">0.00</strong> IOTA
                    </p>
                </div>
            </div>

            <div style="width: 100%; margin-top: auto;">
                <button onclick="startScanner('END')" class="btn danger">SCENDI E PAGA (OUT)</button>
                
                <button onclick="endTrip('OUT-DEBUG-FORCE')" class="link" style="color: #999; margin-top: 20px;">
                    (Debug) Forza Fine Corsa
                </button>
            </div>
        </section>

        <section id="view-result" class="view">
            <div class="ticket card"></div>
        </section>
    </main>

</body>
</html>