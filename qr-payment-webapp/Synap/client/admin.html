<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synap Admin Dashboard</title>
    <style>
        body { font-family: monospace; background: #1e1e1e; color: #0f0; padding: 20px; }
        .card { background: #2d2d2d; padding: 20px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #444; }
        h1, h2 { color: #fff; margin-top: 0; }
        input { padding: 10px; background: #444; border: 1px solid #666; color: #fff; width: 100px; font-family: monospace; }
        button { padding: 10px 20px; background: #007bff; border: none; color: white; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; }
        #logs { height: 400px; overflow-y: scroll; background: #000; padding: 10px; border: 1px solid #444; white-space: pre-wrap; color: #ccc; }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .highlight { color: #ffd700; font-weight: bold; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
    </style>
</head>
<body>

    <h1>üöÄ Synap Server Dashboard</h1>

    <div class="card">
        <h2>üí∞ Configurazione Tariffa</h2>
        <p>Costo attuale: <strong id="current-price" class="highlight">--</strong> IOTA/sec</p>
        
        <div style="display: flex; gap: 10px; align-items: center;">
            <label>Nuovo Costo (IOTA/s):</label>
            <input type="number" id="new-price" step="0.01" min="0.01" placeholder="0.01">
            <button onclick="updatePrice()">AGGIORNA TARIFFA</button>
        </div>
    </div>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>üìú Server Logs (Real-time)</h2>
            <button onclick="fetchLogs()" style="background: #444; font-size: 0.8rem;">Aggiorna</button>
        </div>
        <div id="logs">Caricamento log...</div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';

        // Carica il prezzo attuale
        async function fetchPrice() {
            try {
                const res = await fetch(`${API_URL}/admin/config`);
                const data = await res.json();
                document.getElementById('current-price').innerText = data.costPerSecond;
                document.getElementById('new-price').value = data.costPerSecond;
            } catch(e) { console.error(e); }
        }

        // Aggiorna il prezzo
        async function updatePrice() {
            const price = parseFloat(document.getElementById('new-price').value);
            if(!price || price <= 0) return alert("Inserisci un prezzo valido!");

            try {
                const res = await fetch(`${API_URL}/admin/config`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ costPerSecond: price })
                });
                const data = await res.json();
                if(data.ok) {
                    alert("‚úÖ Tariffa aggiornata!");
                    fetchPrice();
                }
            } catch(e) { alert("Errore aggiornamento"); }
        }

        // Carica i Log
        async function fetchLogs() {
            try {
                const res = await fetch(`${API_URL}/admin/logs`);
                const data = await res.json();
                const logBox = document.getElementById('logs');
                
                logBox.innerHTML = data.logs.map(log => {
                    let className = 'log-entry';
                    if(log.includes("‚úÖ")) className += ' success';
                    if(log.includes("‚ùå") || log.includes("‚ö†Ô∏è")) className += ' error';
                    if(log.includes("üí∏")) className += ' highlight';
                    return `<div class="${className}">${log}</div>`;
                }).join('');
                
                // Scroll to bottom
                logBox.scrollTop = logBox.scrollHeight;
            } catch(e) { console.error(e); }
        }

        // Auto-refresh ogni 2 secondi
        setInterval(fetchLogs, 2000);
        fetchPrice();
        fetchLogs();
    </script>
</body>
</html>